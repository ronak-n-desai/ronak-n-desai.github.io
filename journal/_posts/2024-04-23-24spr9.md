---
layout: post
title: More Improvements to AFRL scripts and GUIs
use_math: true
category: journal
---

This post covers work from 04/22 - 05/03. I spent most of the time working on stuff related to the DAQ work at AFRL. 

# 04/22 Data

Today, we collected data summarized in the following table:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/d1dbea8f-501b-4ef0-97d2-ccf41622fe55)

<!---
| DAQ Run | Start | End | Notes |
| ------ | ------ | ------ | --- |
| 1 | 10:46AM | 11:26AM | Full Looping |
| 2 | 11:44AM | 12:29PM | Not as good as DAQ1 |
| 3 | 1:46PM | 2:29PM | Only looped PP |
--->

We had issues getting the vacuum down to a sufficiently low pressure, which affected DAQ2 and DAQ3. 

# Miscellaneous Info

## Sending commands to adjust target and waveplate positions. 

I tested sending commands to change both the target and waveplate positions. These are the commands for retrieving the target and waveplate positions 

```python
xps.get_stage_position('GROUP2.POSITIONER')
caget('MAINPULSE:pos_RBV')/12880
caget('PREPULSE:pos_RBV')
```

where you would need to do the following imports (and xps connection)

```python
from newportxps import NewportXPS
from epics import caget, caput, cainfo
xps = NewportXPS('196.254.31.60')
```

and the commands to update the positions would be given by 

```python
xps.move_stage('GROUP2.POSITIONER', value=12.5)
caput('MAINPULSE:pos', 120*12880)
caput('PREPULSE:pos', 4)
```

where it is important to note the factor of 12880 for the MAINPULSE position and also that `caget` has RBV (read back value) which is not present in the `caput` command

## Fitting the Spectrum with a Gaussian

I used `scipy.optimize.curve_fit()` to fit a gaussian function of the form $A \exp(-(x-\mu)^2/(2 \sigma^2))$ to the electron traces which actually works pretty well. The area under this curve would be given by $A \sqrt{2 \pi \sigma^2}$ and the mean would simply be $\mu$ which could be used for parameters that fit the data well. The issue with this is that Chris said the data shouldn't look like a gaussian, it might look like that artificially due to the lower pixel numbers not being accesible by the electrons. So, even though I looked at a gaussian fit to adjust the parameters we optimize for, I should primarily focus on the electron count that I have already been using.

## Fixing MP, PP Waveplate Calibration

As a part of our optimization experiment, we need to be able to map the main pulse and prepulse diode voltages to the main pulse and prepulse waveplate angles. For the Main Pulse WP, I came up with the following relation:

\begin{equation}
  \text{LR1}(V_{MP}) \equiv \cos^2(\theta_{MP} - \theta_{MP, max}) = a_0 + a_1 (V_{MP})
\end{equation}

and for the Prepulse WP, I came up with the following relation:

\begin{equation}
  \text{LR2}(V_{MP}, V_{PP}) \equiv \cos^2(\theta_{PP} - \theta_{PP, max}) (1 - \cos^2(\theta_{MP} - \theta_{MP, max})) = b_0 + b_1 (V_{MP}) + b_2 (V_{PP})
\end{equation}

which is to say we are fitting linear regressions from $V_{MP} \rightarrow \theta_{MP}$ and $V_{MP}, V_{PP} \rightarrow \theta_{PP}$ assuming that the cosine squared of the waveplate angle is proportional to the diode voltages. LR2 is dependent on both the main pulse and prepulse voltages because prepulse comes from the fraction of the laser energy that doesn't go into the mainpulse. As a result, changing the mainpulse waveplate will change the amount of energy in the prepulse (even if the prepulse waveplate is kept constant). Using this, we can get our estimate of the main and prepulse angles as

\begin{equation}
  \theta_{MP} = \arccos(\sqrt{\text{LR1}(V_{MP})}) + \theta_{MP, max}
\end{equation}

\begin{equation}
  \theta_{PP} = \arccos(\sqrt{ \frac{\text{LR2}(V_{MP}, V_{PP})}{1 - \text{LR1}(V_{MP})} }) + \theta_{PP, max}
\end{equation}
