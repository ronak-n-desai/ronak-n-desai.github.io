---
layout: post
title: Closing the Loop
use_math: true
category: journal
---

This post covers work from 04/09 to 04/19. I worked with Nathaniel to try to close the loop by implementing a basic optimization script that can send commands back to the EPICS server. Additionally, we submitted the synthetic data paper to ar$\chi$iv and Journal of Plasma Physics as well.

# Updated Oprimization Script
Changes: 
- Placement of constants in  `constants.py` so that the script doesn't need to be directly edited
- Incorporated Waveplate information by fitting linear regression to $\cos(\theta - \theta_0)^2$ to establish proper mapping of diode to waveplate data
- Added flags for `MANUAL_MODE` so that we can control whether the opimization runs automatically or manually.

## 04/11 Preliminary Analysis
I collected data with Nathaniel today, but there are some issues with the data.

1. The Pspec Data didn't get saved, even though the data server was running. 

2. The Pre-Pulse Looping program didn't appear to be running. This can be seen in the following figure taken from the Looping Controls data (where the PP WP is stuck at 4 degrees):
   
![9a5e87b2-46ec-46c3-898f-cbc7927d9a8b](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/ba1f99dc-30e7-40df-9a6d-668e195843b2)

Now, the `reduced_max` variable is absent from the DIODE data and the `reduced_mean` value seems to be nonsense

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/f743e416-69ab-4fea-95d0-d1168c483a8a)

On the other hand, there is this new term called `global_peak5` which appears to roughly move up and down like an intensity would:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/bef3bfd4-d7ae-41bf-b3f4-3220072cc091)

However, I'm not sure what this is and how it makes sense if the waveplate looping program is not updating the PP angle. Also, the MP and PP programs have the same period, so it can't be related to the intensity (at least that's my best guess).

3. In the one of the above figures, the MP Waveplate had a smaller step size at an angle measure of 20 degrees (which corresponds to the calibrated angle for maximum intensity) and a larger step size at a measure of 40 degrees. This should actually be the exact opposite. I presume the same could apply to the PP if it had been looping properly.

With this said, there appears to be some things that went well:

1. The Nozzle Focus is looping correctly:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/47cad2e4-969b-46ca-8c00-5eb7ef295e47)

2. The E-Spec Data appears to make sense

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/9d277e61-0c06-4136-a6f4-bcd743a3f4e1)

# 04-15 Data

I spent some time on 04-12 and the weekend making a GUI to make the analysis of the data a little bit easier.

There were three separate DAQ runs (DAQ1 - 11:48AM to 12:29PM, DAQ2 - 1:58PM to 2:25PM, DAQ3 - 2:44PM to 3:08PM). All the DAQ runs had calibrated max MP and PP Waveplate angles at 118 and 12 degrees respectively (and looped down to 100 and 0 degrees respectively as well).

## Data Distribution

Nathaniel's looping program seemed to work well enough, here are histograms of collected MP, PP, and focus positions from DAQ1 after filtering out runs that had zero electron counts:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/07cd706d-a396-492b-9e51-2b4d2306976f)

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/ee2f79e7-5dae-4698-8257-b4cb5242421b)

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/ce834b5b-9bfd-4ffb-afc7-164803ab51b9)

As before, it seems necessary to filter out data points that have electorn counts less than 100,000 due to the following correlation plot

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/af6951ab-1e81-4f9a-8ccb-1f2c6ec74937)

and we can identify that there are really only three potential locations of focus value that electrons were seen:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/416d06a9-3573-4a38-9a11-275165d135b0)

even though we looped all the way from 12.45 to 12.57 mm in the focus position.

# Waveplate Calibration






# JPP Paper
...
