---
layout: post
title: 03/14 Data, Matlab code
use_math: true
category: journal
---
This week, I have been working on updates to the synthetic data paper as well as looking through data from Monday 03/11. I just collected data on 03/14 where we ran the looping program for both the target (Nozzle Focus) and the Waveplate (Main Pulse Angle). I also work on getting all the data into one consolidated file anchored by the shot number and time.

# 03/14 Data
We were able to get two DAQ runs, the second of which we were able simultaneously run the target looping program and the main pulse waveplate rotating program.

## Target Data
The target data collected throughout the day can be summarized by the following plot

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/e65be187-ee82-4843-85b1-1dcac0a28725)

We can still see that the target data timestamp is still off by around 24 seconds. I also looked at the 121st target file (which falls within the start of DAQ2) which had the same 24 second time difference. Actually, when looking back at the data from 03-11, I also find this 24 second time difference. It seems to be around 24.2 seconds.

## Diode Data

After thinking more about the time information, I realized it is import to specify the timezone, that could be a significant cause for concern between the different files. The Unix time is something that is standardized and represents time since 1970 in seconds in the coordinated universal timezone (UTC). I am running code from my computer in the eastern timezone (which is 4 hours behind UTC b/c we are currently in daylight savings time EDT). 

Here are time results for the DIODEs during DAQ1:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/332865f3-96f5-4b76-9cd1-05a290e42906)

I again see a drift in the times between the main pulse and prepulse. Last time, there was a drift of 13.159ms/1000 shots. Here, it looks like a drift of 13.2ms/1000 shots (which is the same!). As a result, it seems like there is definitely a drift, but we may be able to account for it if it stays a constant. This time, the initial time offset was different even though I ran ntpdate more often than the last time. Looking at the second DAQ run:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/22603db9-544b-43b1-96e9-82fc3d818463)

We see the same 13.2ms/1000 shots drift as before. This time, both diodes were exactly aligned at 0 seconds time difference, which is good. If I were to guess, I might have restarted both beaglebone servers and ran ntpdate just prior to the second DAQ run, but I don't remember if I did or not.

This time, we ran the looping program for the Main Pulse Waveplate which can easily be seen on the diodes around halfway through the DAQ: 

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/3792ddcc-a962-4ed0-b035-cfb69014d1aa)

and since the prepulse shutter was closed, we don't get any reading from the prepulse diode

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/161d0779-c9cc-4982-ac93-5a9de1190ada)

## Espec and Pspec Data

We were able to capture electrons in this data: here are spectra from three of the highest counts: 

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/d465174c-ad47-4a48-af45-951dcff80679)

I will need to do a more detailed analysis to determine where exactly the electron spectra was higher in terms of target conditions. First, I'm going to try to combine all the relevant information into a consolidated dataframe for easier analysis with shot times aligned. I will need to take into account the various time drifts and timezone differences to do this.

The good thing about this run is that the triggers were completely stable, the difference in trigger count didn't change between the Pspec and Espec (up to when the Pspec froze at 4916). Additionally, it looks like none of the triggers were dropped, they increment by one the whole time. From last time, I calculated about a 30.8ms drift per 1 second of data collection. This time, I have around 28.8ms of drift per 1 second of data collection:

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/de9cedf6-8aa6-4f91-895a-5efef5fd1333)

## Waveplate Data

Consistent with the Diode data, I've captured the looping portion of the waveplate data in the last half of the DAQ run

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/e035c78f-9574-441d-b417-5c7d974c7172)



# Combining Code in one Dataframe

# MATLAB code explanation
I tried looking through the MATLAB code that converts the pixel number to an energy value, but it was very difficult to read and I couldn't make sense of things. Instead, I will just explain the simplified explanation that depends on only a constant B field explained [here](https://pubs.aip.org/aip/rsi/article/82/3/033506/359441/Design-of-and-data-reduction-from-compact-Thomson). 

The deflection can be described by the following picture: An positive ion of velocity $v_0$ traveling along the $z$ axis gets deflected upwards (positive x axis) by a magnetic field that points into the page (-y direction) in the region between $z=0$ and $z=z_B$. After the ion leaves this region (i.e. when $z > z_B$), the ion is left to coast in a straight line until it hits the detector at $z = z_o$. This can be visualized in the following picture taken from the paper: 

![image](https://github.com/ronak-n-desai/ronak-n-desai.github.io/assets/98538788/3fe3455b-6cfe-473a-a3f4-c1291fe26ac1)

If the cyclotron radius $r_c = \frac{m v_0}{q B}$, then the location at the detector $x$ and the deflection angle $\phi$ can be calculated as 

\begin{equation}
  x = \frac{z_o  - z_B}{\sqrt{(r_c/z_B)^2 - 1}} + r_c (1 - \sqrt{1 - (z_B/r_c)^2})
\end{equation}

and 

\begin{equation}
  \phi = \arctan( ((r_c/z_B)^2 - 1)^{-1/2} )
\end{equation}


# To Do
- 1
- 2
